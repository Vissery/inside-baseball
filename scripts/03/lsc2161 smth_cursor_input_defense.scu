; LSC2 3 2161 smth_cursor_input_defense

parameter x
parameter y
parameter arg2

local variable local3
local variable local4
local variable fielder: Fielder
local variable ball_fielder: Fielder
local variable local7

if (!x && !y) {
    run-script TransformUserInputVector [gMouseX, gMouseY]
} else {
    run-script TransformUserInputVector [x, y]
}
if (gFielderWithBall) {
    if (gUserSelectedPlay != NONE) {
        free-running-script 0
    }
    local7 = call-script LastClickedBaseOrRunner []
    if (local7 != -1) {
        gUserSelectedPlay = local7
        free-running-script 0
    }
    if (!arg2) {
        local4 = 192
        for local3 = 37 to 45 ++ {
            if (local3 != gFielderWithBall) {
                if ((distance-2d gWorld[LAST-CLICK-FIELDING][X] gWorld[LAST-CLICK-FIELDING][Z] gWorld[local3][X] gWorld[local3][Z]) < local4) {
                    local4 = distance-2d gWorld[LAST-CLICK-FIELDING][X] gWorld[LAST-CLICK-FIELDING][Z] gWorld[local3][X] gWorld[local3][Z]
                    fielder = local3
                }
            }
        }
    }
    if (fielder && fielder != gFielderWithBall) {
        gWorld[LAST-CLICK-FIELDING][X] = gWorld[fielder][X]
        gWorld[LAST-CLICK-FIELDING][Z] = gWorld[fielder][Z]
        if (gWorld[fielder][TARGET] == BALL-SHADOW) {
            gWorld[fielder][TARGET] = NONE
        }
        gUserSelectedPlay = fielder
    } else {
        if (g_maybe_play_is_ready_to_end) {
            if ((distance-2d gWorld[LAST-CLICK-FIELDING][X] gWorld[LAST-CLICK-FIELDING][Z] gWorld[MOUND-CENTER][X] gWorld[MOUND-CENTER][Z]) < 192) {
                gUserSelectedPlay = MOUND
                free-running-script 0
            }
        }
        gUserSelectedPlay = LAST-CLICK-FIELDING
    }
} else {
    if ((call-script DistanceToBall2D [LAST-CLICK-FIELDING]) < 192) {
        gUserSelectedPlay = BALL-SHADOW
        gFieldingTargetX = gWorld[BALL-SHADOW][X]
        gFieldingTargetZ = gWorld[BALL-SHADOW][Z]
        run-script-xc3 SendClosestFielderToTarget []
        free-running-script 0
    }
    for local3 = 0 to 3 ++ {
        if ((distance-2d gWorld[LAST-CLICK-FIELDING][X] gWorld[LAST-CLICK-FIELDING][Z] gWorld[local3][X] gWorld[local3][Z]) < 192) {
            gUserSelectedPlay = local3
            free-running-script 0
        }
    }
    if (!arg2) {
        fielder = call-script FindClosestFielder [gWorld[LAST-CLICK-FIELDING][X], gWorld[LAST-CLICK-FIELDING][Z]]
        ball_fielder = call-script FindClosestFielder [gWorld[BALL-SHADOW][X], gWorld[BALL-SHADOW][Z]]
        if ((distance-2d gWorld[LAST-CLICK-FIELDING][X] gWorld[LAST-CLICK-FIELDING][Z] gWorld[fielder][X] gWorld[fielder][Z]) < 192 && fielder != ball_fielder) {
            gUserSelectedPlay = fielder
            if (gWorld[fielder][TARGET] == BALL-SHADOW) {
                gWorld[fielder][TARGET] = NONE
            }
            free-running-script 0
        }
    }
    gUserSelectedPlay = LAST-CLICK-FIELDING
    gFieldingTargetX = gWorld[LAST-CLICK-FIELDING][X]
    gFieldingTargetZ = gWorld[LAST-CLICK-FIELDING][Z]
    run-script-xc3 SendClosestFielderToTarget []
}
free-script
